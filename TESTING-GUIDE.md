# å¤šæœºå™¨äººæµ‹è¯•æŒ‡å—

## ğŸ¯ æµ‹è¯•ç›®æ ‡

éªŒè¯ä¼˜åŒ–åçš„ chat-hub èƒ½å¤Ÿç¨³å®šæ”¯æŒå¤šä¸ªæœºå™¨äººååŒå·¥ä½œã€‚

## ğŸ“‹ æµ‹è¯•å‡†å¤‡

### 1. ç¯å¢ƒè¦æ±‚
- Node.js 16+
- Redis æœåŠ¡å™¨
- é’‰é’‰ç¾¤ï¼ˆå¯é€‰ï¼‰
- å¤šä¸ª OpenClaw å®ä¾‹ï¼ˆæˆ–å…¶ä»–æœºå™¨äººï¼‰

### 2. å¯åŠ¨ chat-hub
```bash
cd chat-hub

# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config/multi-bot-example.json config/local.json

# ç¼–è¾‘é…ç½®ï¼Œå¡«å…¥ä½ çš„ Redis å’Œé’‰é’‰ä¿¡æ¯
nano config/local.json

# å¯åŠ¨æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼ŒDEBUG æ—¥å¿—ï¼‰
export LOG_LEVEL=DEBUG
npm start
```

### 3. éªŒè¯æœåŠ¡
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# åº”è¯¥è¿”å›
# {"status":"ok","timestamp":...}
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: åŸºç¡€æ¶ˆæ¯æ”¶å‘

**ç›®æ ‡**: éªŒè¯æ¶ˆæ¯èƒ½æ­£ç¡®å­˜å‚¨å’Œå¹¿æ’­

```bash
# å‘é€æµ‹è¯•æ¶ˆæ¯
curl -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d '{"content":"æµ‹è¯•æ¶ˆæ¯ @å°ç³","sender":"æµ‹è¯•ç”¨æˆ·"}'

# æŸ¥çœ‹æ¶ˆæ¯
curl http://localhost:3000/api/context?limit=10

# æœç´¢æ¶ˆæ¯
curl "http://localhost:3000/api/search?q=æµ‹è¯•"
```

**é¢„æœŸç»“æœ**:
- âœ… æ¶ˆæ¯æˆåŠŸå­˜å‚¨åˆ° SQLite
- âœ… æ¶ˆæ¯å¹¿æ’­åˆ° Redis
- âœ… @ æåŠè¢«æ­£ç¡®è§£æ
- âœ… æ—¥å¿—æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

### åœºæ™¯ 2: è¾“å…¥éªŒè¯

**ç›®æ ‡**: éªŒè¯å®‰å…¨é˜²æŠ¤æœºåˆ¶

```bash
# æµ‹è¯• 1: ç©ºæ¶ˆæ¯ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d '{"content":"","sender":"Test"}'

# æµ‹è¯• 2: XSS æ”»å‡»ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d '{"content":"<script>alert(1)</script>","sender":"Test"}'

# æµ‹è¯• 3: è¶…é•¿æ¶ˆæ¯ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d "{\"content\":\"$(python3 -c 'print("a"*10001)')\",\"sender\":\"Test\"}"
```

**é¢„æœŸç»“æœ**:
- âœ… è¿”å› 400 é”™è¯¯
- âœ… é”™è¯¯ä¿¡æ¯æ¸…æ™°
- âœ… æ—¥å¿—è®°å½•éªŒè¯å¤±è´¥

### åœºæ™¯ 3: Redis é‡è¿

**ç›®æ ‡**: éªŒè¯ Redis æ–­çº¿é‡è¿

```bash
# 1. å¯åŠ¨ chat-hub
npm start

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯åœæ­¢ Redis
redis-cli shutdown

# 3. è§‚å¯Ÿæ—¥å¿—ï¼ˆåº”è¯¥çœ‹åˆ°é‡è¿å°è¯•ï¼‰
# [WARN] Redis è¿æ¥å…³é—­
# [INFO] å‘å¸ƒè€…é‡è¿ä¸­... (1)
# [INFO] å‘å¸ƒè€…é‡è¿ä¸­... (2)

# 4. é‡å¯ Redis
redis-server &

# 5. è§‚å¯Ÿæ—¥å¿—ï¼ˆåº”è¯¥çœ‹åˆ°é‡è¿æˆåŠŸï¼‰
# [INFO] å‘å¸ƒè€…å·²è¿æ¥
# [INFO] å‘å¸ƒè€…å°±ç»ª
```

**é¢„æœŸç»“æœ**:
- âœ… è‡ªåŠ¨æ£€æµ‹æ–­çº¿
- âœ… è‡ªåŠ¨å°è¯•é‡è¿
- âœ… é‡è¿æˆåŠŸåæ¢å¤æ­£å¸¸
- âœ… æœåŠ¡ä¸ä¸­æ–­

### åœºæ™¯ 4: å¤šæœºå™¨äººååŒ

**ç›®æ ‡**: éªŒè¯å¤šä¸ªæœºå™¨äººèƒ½æ­£ç¡®æ¥æ”¶å’Œå‘é€æ¶ˆæ¯

#### 4.1 é…ç½®ç¬¬ä¸€ä¸ªæœºå™¨äººï¼ˆå°ç³ï¼‰
```json
// config/local.json
{
  "bot": {
    "name": "å°ç³"
  }
}
```

#### 4.2 é…ç½®ç¬¬äºŒä¸ªæœºå™¨äººï¼ˆå°çŒªï¼‰
åœ¨å¦ä¸€ä¸ªç›®å½•æˆ–æœåŠ¡å™¨ï¼š
```json
// config/local.json
{
  "bot": {
    "name": "å°çŒª"
  },
  "server": {
    "port": 3001  // ä¸åŒç«¯å£
  }
}
```

#### 4.3 æµ‹è¯•æ¶ˆæ¯åŒæ­¥
```bash
# å°ç³å‘é€æ¶ˆæ¯
curl -X POST http://localhost:3000/api/reply \
  -H "Content-Type: application/json" \
  -d '{"content":"å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°ç³","sender":"å°ç³"}'

# å°çŒªåº”è¯¥èƒ½æ”¶åˆ°ï¼ˆé€šè¿‡ Redisï¼‰
# æŸ¥çœ‹å°çŒªçš„æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
# [INFO] ä¿å­˜å›å¤: å°ç³ -> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°ç³

# å°çŒªå›å¤
curl -X POST http://localhost:3001/api/reply \
  -H "Content-Type: application/json" \
  -d '{"content":"ä½ å¥½å°ç³ï¼Œæˆ‘æ˜¯å°çŒª","sender":"å°çŒª"}'

# å°ç³åº”è¯¥èƒ½æ”¶åˆ°
```

**é¢„æœŸç»“æœ**:
- âœ… æ¶ˆæ¯é€šè¿‡ Redis åŒæ­¥
- âœ… ä¸¤ä¸ªæœºå™¨äººéƒ½èƒ½çœ‹åˆ°å¯¹æ–¹çš„æ¶ˆæ¯
- âœ… æ¶ˆæ¯å­˜å‚¨åœ¨å„è‡ªçš„æ•°æ®åº“
- âœ… ä¸ä¼šé‡å¤å‘é€åˆ°é’‰é’‰

### åœºæ™¯ 5: æ™ºèƒ½å¯¹è¯ç®¡ç†

**ç›®æ ‡**: éªŒè¯æ™ºèƒ½å¯¹è¯ç®¡ç†å™¨çš„åŠŸèƒ½

```bash
# 1. å¯ç”¨æ™ºèƒ½æ¨¡å¼
# ç¼–è¾‘ config/local.json
{
  "trigger": {
    "enabled": true,
    "smart": true,
    "maxTurns": 3
  }
}

# 2. é‡å¯æœåŠ¡
npm start

# 3. æ¨¡æ‹Ÿå¯¹è¯
curl -X POST http://localhost:3000/api/store \
  -H "Content-Type: application/json" \
  -d '{"content":"@å°ç³ ä½ å¥½","sender":"ç”¨æˆ·A"}'

# ç­‰å¾…æœºå™¨äººå›å¤...

curl -X POST http://localhost:3000/api/store \
  -H "Content-Type: application/json" \
  -d '{"content":"è°¢è°¢","sender":"ç”¨æˆ·A"}'

# è§‚å¯Ÿæ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
# [INFO] è¯é¢˜ç»ˆç»“: è°¢è°¢
# ï¼ˆä¸ä¼šå†è§¦å‘å›å¤ï¼‰
```

**é¢„æœŸç»“æœ**:
- âœ… æ£€æµ‹åˆ°è¯é¢˜ç»ˆç»“è¯
- âœ… ä¸ä¼šæ— é™å¾ªç¯å›å¤
- âœ… è¶…è¿‡æœ€å¤§è½®æ¬¡ååœæ­¢
- âœ… æ˜ç¡® @ æ—¶ä»ä¼šå›å¤

### åœºæ™¯ 6: é”™è¯¯æ¢å¤

**ç›®æ ‡**: éªŒè¯å„ç§é”™è¯¯æƒ…å†µä¸‹çš„æ¢å¤èƒ½åŠ›

```bash
# 1. æ•°æ®åº“é”å®šï¼ˆæ¨¡æ‹Ÿï¼‰
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯
sqlite3 ~/.openclaw/chat-data/messages.db "BEGIN EXCLUSIVE; SELECT sleep(10);"

# 2. å‘é€æ¶ˆæ¯ï¼ˆåº”è¯¥ç­‰å¾…æˆ–å¤±è´¥ä½†ä¸å´©æºƒï¼‰
curl -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d '{"content":"æµ‹è¯•","sender":"Test"}'

# 3. Redis æ–­çº¿ï¼ˆå·²åœ¨åœºæ™¯ 3 æµ‹è¯•ï¼‰

# 4. é’‰é’‰ Webhook å¤±è´¥
# é…ç½®é”™è¯¯çš„ webhook URLï¼Œå‘é€æ¶ˆæ¯
# åº”è¯¥è®°å½•é”™è¯¯ä½†ä¸å½±å“å…¶ä»–åŠŸèƒ½
```

**é¢„æœŸç»“æœ**:
- âœ… é”™è¯¯è¢«æ­£ç¡®æ•è·
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- âœ… æœåŠ¡ä¸å´©æºƒ
- âœ… å…¶ä»–åŠŸèƒ½æ­£å¸¸

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### å¹¶å‘æµ‹è¯•
```bash
# å®‰è£… Apache Bench
# Ubuntu: sudo apt install apache2-utils
# macOS: brew install httpd

# 100 ä¸ªå¹¶å‘è¯·æ±‚
ab -n 100 -c 10 -p test-data.json -T application/json \
  http://localhost:3000/api/send

# test-data.json å†…å®¹ï¼š
# {"content":"æ€§èƒ½æµ‹è¯•æ¶ˆæ¯","sender":"PerfTest"}
```

**é¢„æœŸç»“æœ**:
- âœ… æ‰€æœ‰è¯·æ±‚æˆåŠŸ
- âœ… å¹³å‡å“åº”æ—¶é—´ < 100ms
- âœ… æ— å†…å­˜æ³„æ¼
- âœ… æ—¥å¿—æ­£å¸¸

### é•¿æ—¶é—´è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œ 24 å°æ—¶ï¼Œæ¯åˆ†é’Ÿå‘é€ä¸€æ¡æ¶ˆæ¯
for i in {1..1440}; do
  curl -X POST http://localhost:3000/api/send \
    -H "Content-Type: application/json" \
    -d "{\"content\":\"é•¿æ—¶é—´æµ‹è¯• $i\",\"sender\":\"LongTest\"}"
  sleep 60
done
```

**é¢„æœŸç»“æœ**:
- âœ… æœåŠ¡ç¨³å®šè¿è¡Œ
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®š
- âœ… Redis è¿æ¥æ­£å¸¸
- âœ… æ•°æ®åº“æ­£å¸¸

## ğŸ› å¸¸è§é—®é¢˜

### 1. Redis è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œ
redis-cli ping

# æ£€æŸ¥é…ç½®
cat config/local.json | grep redis

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
npm start
```

### 2. æ¶ˆæ¯æœªåŒæ­¥
```bash
# æ£€æŸ¥ Redis è®¢é˜…
redis-cli
> PUBSUB CHANNELS
> SUBSCRIBE chat:messages

# æ£€æŸ¥é…ç½®
cat config/local.json | grep channels
```

### 3. éªŒè¯é”™è¯¯
```bash
# æŸ¥çœ‹é”™è¯¯è¯¦æƒ…
curl -v -X POST http://localhost:3000/api/send \
  -H "Content-Type: application/json" \
  -d '{"content":"","sender":"Test"}'

# åº”è¯¥è¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
```

## âœ… æµ‹è¯•æ¸…å•

- [ ] åŸºç¡€æ¶ˆæ¯æ”¶å‘
- [ ] è¾“å…¥éªŒè¯ï¼ˆç©ºæ¶ˆæ¯ã€XSSã€è¶…é•¿ï¼‰
- [ ] Redis é‡è¿æœºåˆ¶
- [ ] å¤šæœºå™¨äººæ¶ˆæ¯åŒæ­¥
- [ ] æ™ºèƒ½å¯¹è¯ç®¡ç†
- [ ] é”™è¯¯æ¢å¤èƒ½åŠ›
- [ ] å¹¶å‘æ€§èƒ½æµ‹è¯•
- [ ] é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# chat-hub æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2026-02-06
**æµ‹è¯•äºº**: ä½ çš„åå­—
**ç‰ˆæœ¬**: v3.2

## æµ‹è¯•ç¯å¢ƒ
- OS: 
- Node.js: 
- Redis: 
- æœºå™¨äººæ•°é‡: 

## æµ‹è¯•ç»“æœ
| åœºæ™¯ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| åŸºç¡€æ¶ˆæ¯æ”¶å‘ | âœ… | |
| è¾“å…¥éªŒè¯ | âœ… | |
| Redis é‡è¿ | âœ… | |
| å¤šæœºå™¨äººååŒ | âœ… | |
| æ™ºèƒ½å¯¹è¯ç®¡ç† | âœ… | |
| é”™è¯¯æ¢å¤ | âœ… | |
| å¹¶å‘æµ‹è¯• | âœ… | 100 req/s |
| é•¿æ—¶é—´è¿è¡Œ | âœ… | 24 å°æ—¶ |

## å‘ç°çš„é—®é¢˜
1. æ— 

## å»ºè®®
1. æ€§èƒ½å¾ˆå¥½ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨

## æ€»ç»“
æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œç³»ç»Ÿç¨³å®šå¯é ã€‚
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¶é—´**: 2026-02-06  
**ä½œè€…**: å°ç³
