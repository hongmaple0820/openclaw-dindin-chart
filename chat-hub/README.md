# Chat-Hubï¼šå¤š AI æœºå™¨äººå®æ—¶èŠå¤©ä¸­è½¬ç«™

åŸºäº Node.js + Redis + SQLite çš„æ¶ˆæ¯ä¸­è½¬æœåŠ¡ï¼Œè®©å¤šä¸ª AI æœºå™¨äººï¼ˆOpenClawï¼‰èƒ½å¤Ÿåœ¨é’‰é’‰ç¾¤ä¸­ä¸äººç±»å®æ—¶èŠå¤©ã€äº’ç›¸å¯¹è¯ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å®æ—¶è§¦å‘** - æ”¶åˆ°æ¶ˆæ¯ç«‹å³è§¦å‘ OpenClawï¼Œæ— éœ€ç­‰å¾…å¿ƒè·³
- ğŸ¤– **å¤šæœºå™¨äººæ”¯æŒ** - å°ç³ã€å°çŒªç­‰å¤šä¸ª AI å¯åŒæ—¶åœ¨çº¿
- ğŸ’¬ **é’‰é’‰é›†æˆ** - æ¥æ”¶/å‘é€é’‰é’‰ç¾¤æ¶ˆæ¯
- ğŸ“¡ **Redis æ¶ˆæ¯æ€»çº¿** - å¤šæœºå™¨äººå…±äº«æ¶ˆæ¯ï¼Œè·¨æœºå™¨é€šä¿¡
- ğŸ—„ï¸ **SQLite æŒä¹…åŒ–** - æ¶ˆæ¯æœ¬åœ°å­˜å‚¨ï¼Œæ”¯æŒæœç´¢å’Œç»Ÿè®¡
- ğŸ”„ **ç¦»çº¿åŒæ­¥** - å‚ä¸è€…ç¦»çº¿åå¯åŒæ­¥æœªè¯»æ¶ˆæ¯
- ğŸ”’ **é…ç½®éš”ç¦»** - æ¯ä¸ªæœºå™¨äººç‹¬ç«‹é…ç½®ï¼Œäº’ä¸å¹²æ‰°
- ğŸ›¡ï¸ **æ¶ˆæ¯å»é‡** - é˜²æ­¢é‡å¤å¤„ç†å’Œå‘é€

## ğŸ—ï¸ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         é’‰é’‰ç¾¤                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Webhook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    chat-hub (å°ç³)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Server    â”‚  â”‚   SQLite    â”‚  â”‚  OpenClawTrigger     â”‚ â”‚
â”‚  â”‚  (Express)  â”‚  â”‚  (æŒä¹…åŒ–)   â”‚  â”‚  (è§¦å‘ OpenClaw)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Redis Pub/Sub (ä»…ä¸­è½¬)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Redis æ¶ˆæ¯æ€»çº¿                          â”‚
â”‚         chat:messages (æ‰€æœ‰æ¶ˆæ¯) / chat:replies (å›å¤)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Redis Pub/Sub
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    chat-hub (å°çŒª)                           â”‚
â”‚         (åŒæ ·çš„ç»“æ„ï¼Œè¿è¡Œåœ¨å¦ä¸€å°æœºå™¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å‰ç½®è¦æ±‚

- Node.js 18+
- Redis æœåŠ¡å™¨ï¼ˆå¯å…±ç”¨è¿œç¨‹ Redisï¼‰
- OpenClaw å·²å®‰è£…å¹¶è¿è¡Œ
- é’‰é’‰ç¾¤æœºå™¨äººï¼ˆWebhook + Outgoingï¼‰

### 2. å…‹éš†é¡¹ç›®

```bash
cd ~/.openclaw
git clone https://gitee.com/hongmaple/openclaw-dindin-chart.git
cd openclaw-dindin-chart/chat-hub
npm install
```

### 3. åˆ›å»ºæœ¬åœ°é…ç½®

**âš ï¸ é‡è¦ï¼šä¸è¦ä¿®æ”¹ `config/default.json`ï¼Œåˆ›å»º `config/local.json` æ¥è¦†ç›–é…ç½®ï¼**

```bash
cat > config/local.json << 'EOF'
{
  "redis": {
    "host": "ä½ çš„Redisåœ°å€",
    "port": 6379,
    "password": "ä½ çš„Rediså¯†ç "
  },
  "bot": {
    "name": "ä½ çš„æœºå™¨äººåï¼ˆå°ç³/å°çŒªï¼‰",
    "local": true
  },
  "dingtalk": {
    "webhookBase": "https://oapi.dingtalk.com/robot/send?access_token=ä½ çš„token",
    "secret": "SECä½ çš„å¯†é’¥"
  }
}
EOF
```

### 4. å¯åŠ¨æœåŠ¡

```bash
npm start
```

æˆ–åå°è¿è¡Œï¼š

```bash
nohup npm start > /tmp/chat-hub.log 2>&1 &
```

### 5. é…ç½®é’‰é’‰ Outgoing Webhook

1. ç™»å½• [é’‰é’‰å¼€æ”¾å¹³å°](https://open.dingtalk.com/)
2. æ‰¾åˆ°ä½ çš„æœºå™¨äºº â†’ æ¶ˆæ¯æ¥æ”¶æ¨¡å¼
3. è®¾ç½® Outgoing åœ°å€: `http://ä½ çš„æœåŠ¡å™¨IP:3000/webhook/dingtalk`

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨

### SQLite æ•°æ®åº“

æ¶ˆæ¯æŒä¹…åŒ–åˆ°æœ¬åœ° SQLite æ•°æ®åº“ï¼ŒRedis ä»…ç”¨äºæ¶ˆæ¯ä¸­è½¬é€šçŸ¥ã€‚

- **æ•°æ®åº“ä½ç½®**: `~/.openclaw/chat-data/messages.db`
- **è¡¨ç»“æ„**:
  - `messages` - æ¶ˆæ¯è®°å½•
  - `sync_state` - å‚ä¸è€…åŒæ­¥çŠ¶æ€

### ç¦»çº¿åŒæ­¥

å½“å‚ä¸è€…ç¦»çº¿åé‡æ–°ä¸Šçº¿ï¼Œå¯ä»¥è·å–æœªè¯»æ¶ˆæ¯ï¼š

```bash
# è·å–æœªåŒæ­¥æ¶ˆæ¯
GET /api/sync/:participantId

# æ ‡è®°å·²åŒæ­¥
POST /api/sync/:participantId
```

## ğŸ“¡ API æ¥å£

### å¥åº·æ£€æŸ¥

```bash
GET /health
# è¿”å›: çŠ¶æ€ã€æ¶ˆæ¯æ€»æ•°ã€ä»Šæ—¥æ¶ˆæ¯æ•°ã€é…ç½®ä¿¡æ¯
```

### å‘é€æ¶ˆæ¯ï¼ˆWeb å‰ç«¯ï¼Œä¼šå‘åˆ°é’‰é’‰ï¼‰

```bash
POST /api/send
Content-Type: application/json

{"content": "æ¶ˆæ¯å†…å®¹", "sender": "å‘é€è€…"}
```

### æœºå™¨äººå›å¤ï¼ˆä¼šå‘åˆ°é’‰é’‰ï¼‰

```bash
POST /api/reply
Content-Type: application/json

{"content": "å›å¤å†…å®¹", "sender": "å°ç³"}
```

### è·å–æ¶ˆæ¯åˆ—è¡¨

```bash
GET /api/context?limit=50
```

### æœç´¢æ¶ˆæ¯

```bash
GET /api/search?q=å…³é”®è¯&limit=50
```

### è·å–ç»Ÿè®¡ä¿¡æ¯

```bash
GET /api/stats
# è¿”å›: æ€»æ¶ˆæ¯æ•°ã€ä»Šæ—¥æ¶ˆæ¯æ•°ã€å„å‘é€è€…ç»Ÿè®¡
```

### åˆ é™¤æ¶ˆæ¯

```bash
DELETE /api/message/:messageId
```

### è·å–æœªåŒæ­¥æ¶ˆæ¯

```bash
GET /api/sync/:participantId
```

### æ ‡è®°å·²åŒæ­¥

```bash
POST /api/sync/:participantId
Content-Type: application/json

{"timestamp": 1234567890}
```

### è·å–åŒæ­¥çŠ¶æ€

```bash
GET /api/sync-status
```

### é’‰é’‰ Webhook å›è°ƒ

```bash
POST /webhook/dingtalk
```

## ğŸ”§ é…ç½®è¯´æ˜

### config/default.jsonï¼ˆé»˜è®¤é…ç½®ï¼‰

```json
{
  "server": { "port": 3000 },
  "redis": {
    "host": "localhost",
    "port": 6379,
    "password": ""
  },
  "store": {
    "dir": "~/.openclaw/chat-data",
    "maxMessages": 10000
  },
  "bots": {
    "cooldownMs": 3000,
    "contextSize": 50
  },
  "channels": {
    "messages": "chat:messages",
    "replies": "chat:replies"
  },
  "dedup": {
    "enabled": true,
    "ttlSeconds": 300
  }
}
```

### config/local.jsonï¼ˆæœ¬åœ°é…ç½®ï¼Œä¸åœ¨ Git ä¸­ï¼‰

```json
{
  "redis": {
    "host": "ä½ çš„Redisåœ°å€",
    "port": 6379,
    "password": "ä½ çš„å¯†ç "
  },
  "bot": {
    "name": "å°ç³",
    "local": true
  },
  "dingtalk": {
    "webhookBase": "https://oapi.dingtalk.com/robot/send?access_token=xxx",
    "secret": "SECxxx"
  }
}
```

## ğŸ”Œ ä¸ OpenClaw é›†æˆ

### å·¥ä½œåŸç†

1. é’‰é’‰ç¾¤æ¶ˆæ¯é€šè¿‡ Webhook å‘é€åˆ° chat-hub
2. chat-hub ä¿å­˜æ¶ˆæ¯åˆ° SQLiteï¼Œå¹¶å‘å¸ƒåˆ° Redis
3. OpenClawTrigger ç›‘å¬ Redisï¼Œå‘ç°æ¶ˆæ¯æåˆ°è‡ªå·±æ—¶
4. æ‰§è¡Œ `openclaw system event` è§¦å‘ OpenClaw å¤„ç†
5. OpenClaw ç”Ÿæˆå›å¤ï¼Œé€šè¿‡ `/api/reply` å‘é€
6. chat-hub å‘é€å›å¤åˆ°é’‰é’‰ç¾¤ï¼Œå¹¶ä¿å­˜åˆ° SQLite

### OpenClaw å›å¤æ–¹å¼

åœ¨ HEARTBEAT.md æˆ– AGENTS.md ä¸­æ·»åŠ è§„åˆ™ï¼Œæ”¶åˆ° `[é’‰é’‰ç¾¤æ¶ˆæ¯]` æ—¶ç”¨ curl å›å¤ï¼š

```bash
curl -X POST http://localhost:3000/api/reply \
  -H "Content-Type: application/json" \
  -d '{"content": "å›å¤å†…å®¹", "sender": "å°ç³"}'
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
chat-hub/
â”œâ”€â”€ package.json
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default.json          # é»˜è®¤é…ç½®
â”‚   â”œâ”€â”€ local.json            # æœ¬åœ°é…ç½®ï¼ˆä¸åœ¨ Git ä¸­ï¼‰
â”‚   â””â”€â”€ local.example.json    # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # å…¥å£
â”‚   â”œâ”€â”€ config.js             # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ server.js             # Express æœåŠ¡
â”‚   â”œâ”€â”€ message-store.js      # SQLite æ¶ˆæ¯å­˜å‚¨
â”‚   â”œâ”€â”€ redis-client.js       # Redis å°è£…
â”‚   â”œâ”€â”€ dingtalk.js           # é’‰é’‰ API
â”‚   â””â”€â”€ bots/
â”‚       â””â”€â”€ openclaw-trigger.js  # OpenClaw è§¦å‘å™¨
â”œâ”€â”€ chat-hub.service          # systemd æœåŠ¡æ–‡ä»¶
â””â”€â”€ install-service.sh        # å®‰è£…æœåŠ¡è„šæœ¬
```

## ğŸš€ éƒ¨ç½²ä¸º systemd æœåŠ¡

```bash
# å®‰è£…æœåŠ¡
sudo ./install-service.sh

# ç®¡ç†æœåŠ¡
sudo systemctl status chat-hub
sudo systemctl restart chat-hub
sudo journalctl -u chat-hub -f
```

## âš ï¸ å¤šæœºå™¨äººæ³¨æ„äº‹é¡¹

### é…ç½®éš”ç¦»

- `config/local.json` åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šåŒæ­¥
- æ¯ä¸ªæœºå™¨äººçš„ `local.json` å†…å®¹ä¸åŒ
- `git pull` ä¸ä¼šè¦†ç›–æœ¬åœ°é…ç½®

### å¯†é’¥ç®¡ç†

- æ¯ä¸ªæœºå™¨äººç”¨è‡ªå·±çš„é’‰é’‰ Webhook å¯†é’¥
- å¯†é’¥åªå­˜åœ¨ `local.json` ä¸­
- ä¸è¦æŠŠå¯†é’¥æäº¤åˆ° Git

### èŠå¤©è§„åˆ™

æœºå™¨äººä¹‹é—´èŠå¤©éœ€è¦äººç±»å…è®¸ï¼š
1. äººç±»è¯´"ä½ ä»¬èŠ"æˆ–åŒæ—¶æåˆ°ä¸¤ä¸ªåå­— â†’ å¯ä»¥èŠ
2. äººç±»è¯´"æš‚åœ" â†’ åœæ­¢èŠå¤©
3. ä¸èƒ½å·å·èŠå¤©

## ğŸ› å¸¸è§é—®é¢˜

### Q: æœºå™¨äººä¸å›å¤ï¼Ÿ

1. æ£€æŸ¥ OpenClaw Gatewayï¼š`openclaw gateway status`
2. æ£€æŸ¥ chat-hub æ—¥å¿—ï¼š`tail -f /tmp/chat-hub.log`
3. ç¡®è®¤ `bot.name` å’Œæ¶ˆæ¯ä¸­æåˆ°çš„åå­—ä¸€è‡´

### Q: æ¶ˆæ¯å‘é€å¤±è´¥ï¼Ÿ

1. æ£€æŸ¥é’‰é’‰å¯†é’¥æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç”¨çš„æ˜¯è‡ªå·±çš„å¯†é’¥

### Q: æ”¶ä¸åˆ°é’‰é’‰æ¶ˆæ¯ï¼Ÿ

1. æ£€æŸ¥ Outgoing Webhook åœ°å€
2. æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3000 ç«¯å£

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.3 (2026-02-05)

- æ–°å¢ï¼šSQLite æ¶ˆæ¯æŒä¹…åŒ–ï¼ˆæ›¿ä»£ Redis å­˜å‚¨ï¼‰
- æ–°å¢ï¼šæ¶ˆæ¯æœç´¢ API
- æ–°å¢ï¼šç»Ÿè®¡ä¿¡æ¯ API
- æ–°å¢ï¼šç¦»çº¿åŒæ­¥æœºåˆ¶
- æ–°å¢ï¼šåˆ é™¤æ¶ˆæ¯ API
- æ”¹è¿›ï¼šå‰ç«¯æ”¹å MapleChatRoom

### v2.2 (2026-02-05)

- æ–°å¢ï¼šé…ç½®éš”ç¦»ï¼ˆlocal.jsonï¼‰
- æ–°å¢ï¼šæœºå™¨äººäº’ç›¸è§¦å‘
- ä¿®å¤ï¼šæ¶ˆæ¯é‡å¤å‘é€é—®é¢˜

### v2.0 (2026-02-04)

- æ–°å¢ï¼šæ¶ˆæ¯å»é‡æœºåˆ¶
- æ–°å¢ï¼šä¸Šä¸‹æ–‡è®°å¿†
- é‡æ„ï¼šä½¿ç”¨ OpenClawTrigger

## ğŸ“„ è®¸å¯è¯

MIT
