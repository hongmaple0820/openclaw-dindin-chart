# Chat-Hubï¼šå¤š AI æœºå™¨äººå®æ—¶èŠå¤©ä¸­è½¬ç«™

åŸºäº Node.js + Redis çš„æ¶ˆæ¯ä¸­è½¬æœåŠ¡ï¼Œè®©å¤šä¸ª AI æœºå™¨äººï¼ˆOpenClawï¼‰èƒ½å¤Ÿåœ¨é’‰é’‰ç¾¤ä¸­ä¸äººç±»å®æ—¶èŠå¤©ã€äº’ç›¸å¯¹è¯ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å®æ—¶è§¦å‘** - æ”¶åˆ°æ¶ˆæ¯ç«‹å³è§¦å‘ OpenClawï¼Œæ— éœ€ç­‰å¾…å¿ƒè·³
- ğŸ¤– **å¤šæœºå™¨äººæ”¯æŒ** - å°ç³ã€å°çŒªç­‰å¤šä¸ª AI å¯åŒæ—¶åœ¨çº¿
- ğŸ’¬ **é’‰é’‰é›†æˆ** - æ¥æ”¶/å‘é€é’‰é’‰ç¾¤æ¶ˆæ¯
- ğŸ“¡ **Redis æ¶ˆæ¯æ€»çº¿** - å¤šæœºå™¨äººå…±äº«æ¶ˆæ¯ï¼Œè·¨æœºå™¨é€šä¿¡
- ğŸ”’ **é…ç½®éš”ç¦»** - æ¯ä¸ªæœºå™¨äººç‹¬ç«‹é…ç½®ï¼Œäº’ä¸å¹²æ‰°
- ğŸ›¡ï¸ **æ¶ˆæ¯å»é‡** - é˜²æ­¢é‡å¤å¤„ç†å’Œå‘é€
- ğŸ“ **ä¸Šä¸‹æ–‡è®°å¿†** - ä¿ç•™æœ€è¿‘æ¶ˆæ¯ä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡

## ğŸ—ï¸ æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         é’‰é’‰ç¾¤                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Webhook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    chat-hub (å°ç³)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Server    â”‚  â”‚  DingTalk   â”‚  â”‚  OpenClawTrigger     â”‚ â”‚
â”‚  â”‚  (Express)  â”‚  â”‚  (å‘é€)     â”‚  â”‚  (è§¦å‘ OpenClaw)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Redis Pub/Sub
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Redis æ¶ˆæ¯æ€»çº¿                          â”‚
â”‚         chat:messages (æ‰€æœ‰æ¶ˆæ¯) / chat:replies (å›å¤)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Redis Pub/Sub
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    chat-hub (å°çŒª)                           â”‚
â”‚         (åŒæ ·çš„ç»“æ„ï¼Œè¿è¡Œåœ¨å¦ä¸€å°æœºå™¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å‰ç½®è¦æ±‚

- Node.js 18+
- Redis æœåŠ¡å™¨ï¼ˆå¯å…±ç”¨è¿œç¨‹ Redisï¼‰
- OpenClaw å·²å®‰è£…å¹¶è¿è¡Œ
- é’‰é’‰ç¾¤æœºå™¨äººï¼ˆWebhook + Outgoingï¼‰

### 2. å…‹éš†é¡¹ç›®

```bash
cd ~/.openclaw
git clone https://gitee.com/hongmaple/openclaw-dindin-chart.git
cd openclaw-dindin-chart/chat-hub
npm install
```

### 3. åˆ›å»ºæœ¬åœ°é…ç½®

**âš ï¸ é‡è¦ï¼šä¸è¦ä¿®æ”¹ `config/default.json`ï¼Œåˆ›å»º `config/local.json` æ¥è¦†ç›–é…ç½®ï¼**

```bash
cat > config/local.json << 'EOF'
{
  "bot": {
    "name": "ä½ çš„æœºå™¨äººåï¼ˆå°ç³/å°çŒªï¼‰",
    "local": true
  },
  "dingtalk": {
    "webhookBase": "https://oapi.dingtalk.com/robot/send?access_token=ä½ çš„token",
    "secret": "ä½ çš„å¯†é’¥"
  }
}
EOF
```

### 4. å¯åŠ¨æœåŠ¡

```bash
npm start
```

æˆ–åå°è¿è¡Œï¼š

```bash
nohup npm start > /tmp/chat-hub.log 2>&1 &
```

### 5. é…ç½®é’‰é’‰ Outgoing Webhook

1. ç™»å½• [é’‰é’‰å¼€æ”¾å¹³å°](https://open.dingtalk.com/)
2. æ‰¾åˆ°ä½ çš„æœºå™¨äºº â†’ æ¶ˆæ¯æ¥æ”¶æ¨¡å¼
3. è®¾ç½® Outgoing åœ°å€: `http://ä½ çš„æœåŠ¡å™¨IP:3000/webhook/dingtalk`

## ğŸ”§ é…ç½®è¯´æ˜

### config/default.jsonï¼ˆé»˜è®¤é…ç½®ï¼Œåœ¨ Git ä¸­ï¼‰

```json
{
  "server": { "port": 3000 },
  "redis": {
    "host": "47.96.248.176",
    "port": 6379,
    "password": "ä½ çš„å¯†ç "
  },
  "bots": {
    "cooldownMs": 3000,
    "contextSize": 10
  },
  "channels": {
    "messages": "chat:messages",
    "replies": "chat:replies"
  },
  "dedup": {
    "enabled": true,
    "ttlSeconds": 300
  }
}
```

### config/local.jsonï¼ˆæœ¬åœ°é…ç½®ï¼Œä¸åœ¨ Git ä¸­ï¼‰

**å°ç³çš„é…ç½®**ï¼š
```json
{
  "bot": {
    "name": "å°ç³",
    "local": true
  },
  "dingtalk": {
    "webhookBase": "https://oapi.dingtalk.com/robot/send?access_token=å°ç³çš„token",
    "secret": "SECå°ç³çš„å¯†é’¥"
  }
}
```

**å°çŒªçš„é…ç½®**ï¼š
```json
{
  "bot": {
    "name": "å°çŒª",
    "local": true
  },
  "dingtalk": {
    "webhookBase": "https://oapi.dingtalk.com/robot/send?access_token=å°çŒªçš„token",
    "secret": "SECå°çŒªçš„å¯†é’¥"
  }
}
```

## ğŸ”Œ ä¸ OpenClaw é›†æˆ

### å·¥ä½œåŸç†

1. é’‰é’‰ç¾¤æ¶ˆæ¯é€šè¿‡ Webhook å‘é€åˆ° chat-hub
2. chat-hub å°†æ¶ˆæ¯å‘å¸ƒåˆ° Redis
3. OpenClawTrigger ç›‘å¬ Redisï¼Œå‘ç°æ¶ˆæ¯æåˆ°è‡ªå·±æ—¶
4. æ‰§è¡Œ `openclaw system event` è§¦å‘ OpenClaw å¤„ç†
5. OpenClaw ç”Ÿæˆå›å¤ï¼Œé€šè¿‡ `/api/reply` å‘é€
6. chat-hub å‘é€å›å¤åˆ°é’‰é’‰ç¾¤

### è§¦å‘è§„åˆ™

- æ¶ˆæ¯æåˆ°æœºå™¨äººåå­— â†’ è§¦å‘
- äººç±»æ¶ˆæ¯ï¼ˆæ²¡æœ‰ @ å…¶ä»–æœºå™¨äººï¼‰â†’ è§¦å‘
- æœºå™¨äººæ¶ˆæ¯æ²¡æåˆ°è‡ªå·± â†’ ä¸è§¦å‘

### OpenClaw å›å¤æ–¹å¼

åœ¨ OpenClaw ä¸­ä½¿ç”¨ curl è°ƒç”¨ `/api/reply`ï¼š

```bash
curl -X POST http://localhost:3000/api/reply \
  -H "Content-Type: application/json" \
  -d '{"content": "å›å¤å†…å®¹", "sender": "å°ç³"}'
```

## ğŸ“¡ API æ¥å£

### å¥åº·æ£€æŸ¥

```bash
GET /health
```

### å‘é€æ¶ˆæ¯åˆ° Redisï¼ˆä¸å‘é’‰é’‰ï¼‰

```bash
POST /api/send
Content-Type: application/json

{"content": "æ¶ˆæ¯å†…å®¹", "sender": "å‘é€è€…"}
```

### å‘é€å›å¤ï¼ˆä¼šå‘åˆ°é’‰é’‰ï¼‰

```bash
POST /api/reply
Content-Type: application/json

{"content": "å›å¤å†…å®¹", "sender": "å°ç³"}
```

### è·å–ä¸Šä¸‹æ–‡

```bash
GET /api/context
```

### é’‰é’‰ Webhook å›è°ƒ

```bash
POST /webhook/dingtalk
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
chat-hub/
â”œâ”€â”€ package.json
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default.json          # é»˜è®¤é…ç½®ï¼ˆåœ¨ Git ä¸­ï¼‰
â”‚   â”œâ”€â”€ local.json            # æœ¬åœ°é…ç½®ï¼ˆä¸åœ¨ Git ä¸­ï¼‰
â”‚   â””â”€â”€ local.example.json    # æœ¬åœ°é…ç½®ç¤ºä¾‹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js              # å…¥å£
â”‚   â”œâ”€â”€ config.js             # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ server.js             # Express æœåŠ¡
â”‚   â”œâ”€â”€ redis-client.js       # Redis å°è£…
â”‚   â”œâ”€â”€ dingtalk.js           # é’‰é’‰ API
â”‚   â””â”€â”€ bots/
â”‚       â””â”€â”€ openclaw-trigger.js  # OpenClaw è§¦å‘å™¨
â”œâ”€â”€ chat-hub.service          # systemd æœåŠ¡æ–‡ä»¶
â””â”€â”€ install-service.sh        # å®‰è£…æœåŠ¡è„šæœ¬
```

## ğŸš€ éƒ¨ç½²ä¸º systemd æœåŠ¡

```bash
# å®‰è£…æœåŠ¡
sudo ./install-service.sh

# ç®¡ç†æœåŠ¡
sudo systemctl status chat-hub
sudo systemctl restart chat-hub
sudo journalctl -u chat-hub -f
```

## âš ï¸ å¤šæœºå™¨äººæ³¨æ„äº‹é¡¹

### é…ç½®éš”ç¦»

å°ç³å’Œå°çŒªå…±ç”¨åŒä¸€ä¸ª Git ä»“åº“ï¼Œä½†ï¼š
- `config/local.json` åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šåŒæ­¥
- æ¯ä¸ªæœºå™¨äººçš„ `local.json` å†…å®¹ä¸åŒ
- `git pull` ä¸ä¼šè¦†ç›–æœ¬åœ°é…ç½®

### å¯†é’¥ç®¡ç†

- æ¯ä¸ªæœºå™¨äººç”¨è‡ªå·±çš„é’‰é’‰ Webhook å¯†é’¥
- ä¸è¦æŠŠå¯†é’¥å†™åœ¨ `default.json` é‡Œ
- å¯†é’¥åªå­˜åœ¨ `local.json` ä¸­

### èŠå¤©è§„åˆ™

æœºå™¨äººä¹‹é—´èŠå¤©éœ€è¦äººç±»å…è®¸ï¼š
1. äººç±»è¯´"ä½ ä»¬èŠ"æˆ–åŒæ—¶æåˆ°ä¸¤ä¸ªåå­— â†’ å¯ä»¥èŠ
2. äººç±»è¯´"æš‚åœ" â†’ åœæ­¢èŠå¤©
3. ä¸èƒ½å·å·èŠå¤©

## ğŸ› å¸¸è§é—®é¢˜

### Q: æœºå™¨äººä¸å›å¤ï¼Ÿ

1. æ£€æŸ¥ OpenClaw Gateway æ˜¯å¦è¿è¡Œï¼š`openclaw gateway status`
2. æ£€æŸ¥ chat-hub æ—¥å¿—ï¼š`tail -f /tmp/chat-hub.log`
3. ç¡®è®¤ `bot.name` å’Œæ¶ˆæ¯ä¸­æåˆ°çš„åå­—ä¸€è‡´

### Q: æ¶ˆæ¯å‘é€å¤±è´¥ï¼Ÿ

1. æ£€æŸ¥é’‰é’‰å¯†é’¥æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç”¨çš„æ˜¯è‡ªå·±çš„å¯†é’¥ï¼Œä¸æ˜¯åˆ«äººçš„

### Q: æ¶ˆæ¯é‡å¤å‘é€ï¼Ÿ

ç¡®ä¿ç”¨æœ€æ–°ä»£ç ï¼š`git pull origin main`

### Q: æ”¶ä¸åˆ°é’‰é’‰æ¶ˆæ¯ï¼Ÿ

1. æ£€æŸ¥ Outgoing Webhook åœ°å€æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 3000 ç«¯å£

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.2 (2026-02-05)

- æ–°å¢ï¼šé…ç½®éš”ç¦»ï¼ˆlocal.jsonï¼‰
- æ–°å¢ï¼šæœºå™¨äººäº’ç›¸è§¦å‘ï¼ˆæåˆ°åå­—å°±è§¦å‘ï¼‰
- ä¿®å¤ï¼šæ¶ˆæ¯é‡å¤å‘é€é—®é¢˜
- ä¼˜åŒ–ï¼šè§¦å‘å™¨é€»è¾‘

### v2.0 (2026-02-04)

- æ–°å¢ï¼šæ¶ˆæ¯å»é‡æœºåˆ¶
- æ–°å¢ï¼šä¸Šä¸‹æ–‡è®°å¿†
- æ–°å¢ï¼šå¾ªç¯é˜²æŠ¤
- é‡æ„ï¼šä½¿ç”¨ OpenClawTrigger

## ğŸ“„ è®¸å¯è¯

MIT
